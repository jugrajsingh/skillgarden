# =============================================================================
# Base pre-commit configuration for Python projects
# =============================================================================
#
# Usage: Copy to project root as .pre-commit-config.yaml, then:
#   pre-commit install
#   pre-commit run --all-files
#   pre-commit autoupdate
#
# Conventions:
#   - YAML arrays (not JSON brackets) for args
#   - Sections: Security → Standard checks → Python tooling → Optional
#   - Ruff replaces: black, isort, flake8, bandit, autopep8, autoflake
#   - Branch protection: main + develop (git-flow)
#
# =============================================================================

minimum_pre_commit_version: 3.6.0
default_install_hook_types:
  - pre-commit
  - commit-msg
fail_fast: false

repos:
  # ============================================================
  # 1. SECURITY (detect secrets and vulnerabilities early)
  # ============================================================

  # Detect secrets, API keys, credentials in any file type
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.21.2
    hooks:
      - id: gitleaks

  # Scan dependencies for known vulnerabilities
  - repo: https://github.com/pypa/pip-audit
    rev: v2.7.3
    hooks:
      - id: pip-audit
        args:
          - --desc
          - --format=columns

  # ============================================================
  # 2. STANDARD CHECKS (file validation, git hygiene)
  # ============================================================

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      # Security
      - id: detect-private-key
      - id: check-added-large-files
        args:
          - --maxkb=1000

      # Branch protection (git-flow: main + develop)
      - id: no-commit-to-branch
        args:
          - --branch
          - main
          - --branch
          - develop

      # Python validation
      - id: check-ast
      - id: debug-statements

      # File format validation
      - id: check-yaml
        exclude: '^chart/templates/'
      - id: check-json
      - id: check-toml

      # Git hygiene
      - id: check-merge-conflict
      - id: check-case-conflict

      # Whitespace (auto-fix)
      - id: end-of-file-fixer
      - id: trailing-whitespace
      - id: mixed-line-ending
        args:
          - --fix=lf

  # ============================================================
  # 3. PYTHON: RUFF (replaces black, isort, flake8, bandit)
  # ============================================================

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.6
    hooks:
      # Linting with auto-fix (includes security S rules)
      - id: ruff
        args:
          - --fix
          - --exit-non-zero-on-fix
      # Formatting (replaces black)
      - id: ruff-format

  # ============================================================
  # 4. CONVENTIONAL COMMITS (commit-msg stage)
  # ============================================================

  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v4.0.0
    hooks:
      - id: conventional-pre-commit
        stages:
          - commit-msg
        args:
          - feat
          - fix
          - docs
          - style
          - refactor
          - perf
          - test
          - build
          - ci
          - chore
          - revert

# =============================================================================
# OPTIONAL HOOKS (uncomment as needed)
# =============================================================================
#
# Typo detection (recommended for docs-heavy projects):
#
#  - repo: https://github.com/codespell-project/codespell
#    rev: v2.3.0
#    hooks:
#      - id: codespell
#        args:
#          - --skip
#          - "*.lock,*.svg"
#
# Markdown linting (if .md files present):
#
#  - repo: https://github.com/igorshubovych/markdownlint-cli
#    rev: v0.43.0
#    hooks:
#      - id: markdownlint
#        args:
#          - --fix
#          - --disable
#          - MD013
#          - MD024
#          - MD033
#          - MD041
#          - --
#
# Type checking (for strict type safety):
#
#  - repo: https://github.com/pre-commit/mirrors-mypy
#    rev: v1.13.0
#    hooks:
#      - id: mypy
#        additional_dependencies:
#          - types-all
#
# Makefile linting (if Makefiles present):
#
#  - repo: local
#    hooks:
#      - id: mbake
#        name: mbake format
#        entry: mbake format --check
#        language: python
#        additional_dependencies:
#          - mbake
#        files: (^|/)Makefile$
#        types:
#          - file
#
# Dockerfile linting (if Dockerfiles present):
#
#  - repo: https://github.com/hadolint/hadolint
#    rev: v2.12.0
#    hooks:
#      - id: hadolint-docker
#        args:
#          - --ignore
#          - DL3008
#          - --ignore
#          - DL3013
